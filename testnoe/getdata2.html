<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Leaderboards</title>
</head>
<body>

<div id="playerProfiles"></div>

<script>
// Function to fetch player profile data
async function fetchPlayerProfile(username) {
    const url = `https://api.chess.com/pub/player/${username}`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching player profile:', error);
        return null;
    }
}

// Function to fetch and display player profiles for the first 10 titled players
async function fetchAndDisplayPlayerProfiles() {
    const titleAbbreviation = 'WCM'; // Change this to any other valid title abbreviation if needed
    const url = `https://api.chess.com/pub/titled/${titleAbbreviation}`;

    try {
        const response = await fetch(url);
        const data = await response.json();

        const playerProfilesPromises = data.players.slice(0, 10).map(async (player) => {
            const profile = await fetchPlayerProfile(player);
            return profile ? profile : { error: "Data not found" };
        });

        const playerProfiles = await Promise.all(playerProfilesPromises);

        let html = `<h2>Player Profiles</h2>`;
        html += '<ul>';

        for (const profile of playerProfiles) {
            html += '<li>';
            if (profile.error) {
                html += profile.error;
            } else {
                const countryName = profile.country ? await fetchCountryName(profile.country) : 'Unknown';
                html += `Username: ${profile.username}, Title: ${profile.title ? profile.title : 'None'}, Country: ${countryName}, Last Online: ${new Date(profile.last_online * 1000).toLocaleDateString()}, Followers: ${profile.followers}, Joined: ${new Date(profile.joined * 1000).toLocaleDateString()}, Status: ${profile.status}, Streamer: ${profile.is_streamer ? 'Yes' : 'No'}, Verified: ${profile.verified ? 'Yes' : 'No'}, League: ${profile.league ? profile.league : 'None'}`;
            }
            html += '</li>';
        }

        html += '</ul>';

        document.getElementById('playerProfiles').innerHTML = html;
    } catch (error) {
        console.error('Error fetching player profiles:', error);
    }
}

// Function to fetch country name
async function fetchCountryName(countryUrl) {
    try {
        const response = await fetch(countryUrl);
        const data = await response.json();
        return data.name;
    } catch (error) {
        console.error('Error fetching country name:', error);
        return 'Unknown';
    }
}

// Call the function to fetch and display player profiles
fetchAndDisplayPlayerProfiles();
</script>

</body>
</html>